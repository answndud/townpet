# TownPet 프로젝트 요약 보고서

## 📋 목차
1. [프로젝트 개요](#1-프로젝트-개요)
2. [기술 스택](#2-기술-스택)
3. [프로젝트 구조](#3-프로젝트-구조)
4. [도메인 모델](#4-도메인-모델)
5. [주요 기능 분석](#5-주요-기능-분석)
6. [보안/운영(신뢰) 구현](#6-보안운영신뢰-구현)
7. [현재 설계 리스크 및 보완 과제](#7-현재-설계-리스크-및-보완-과제)

---

## 1. 프로젝트 개요

### 1.1 프로젝트 정의
- **프로젝트명**: TownPet
- **형태**: 동네 기반(Local) + 지식 축적(Global) 하이브리드 반려동물 커뮤니티
- **목적**
  - 동네 단위에서 “병원/장소 정보, 산책, 거래/나눔, 긴급 돌봄/실종”을 연결
  - 지역 무관한 “품종/사료/행동 교정” 지식(Q&A/DB)을 축적
  - 커뮤니티 운영 자동화(신고/어뷰징 방지/정책)를 제품의 핵심 설계로 포함

### 1.2 핵심 비즈니스 도메인
```
TownPet
├── Local(동네 기반)
│   ├── 동네 인프라 비교(병원/미용/동반가능 식당·카페)
│   ├── 산책로 공유(안전/환경 태그 + 지도)
│   ├── 산책 메이트/번개(실시간 모임)
│   ├── 마켓/대여/나눔(사료/용품)
│   ├── 마이크로 펫시팅/긴급 돌봄
│   └── 실종/유기 알림(골든타임 기반 위치 노출)
└── Global(지역 무관)
    ├── 품종/묘종 토픽 커뮤니티
    ├── Q&A(채택/신뢰도/검색 유입)
    ├── 사료/용품 DB(성분/알러지 필터/리뷰)
    └── 전문가 콘텐츠(수의사/훈련사 기고)
```

### 1.3 사용자 역할(Role)
| Role Code | Role Name | 설명 |
|---|---|---|
| 0 | ROLE_ADMIN | 운영자(정책/제재/콘텐츠 관리, 파트너 검수) |
| 1 | ROLE_USER | 일반 사용자(게시/리뷰/거래/신고/참여) |
| 2 | ROLE_CARE_PROVIDER | 펫시터/도그워커(구인/지원/예약·상태) |
| 3 | ROLE_BUSINESS | 지역 업장(병원/미용/카페 등 프로필/쿠폰/광고) |

---

## 2. 기술 스택

### 2.1 Backend
| 기술 | 버전(권장) | 용도 |
|---|---:|---|
| Java | 21 (LTS) | 메인 언어 |
| Spring Boot | 3.x | 웹/DI/운영 |
| Spring Web MVC | - | SSR + 컨트롤러 |
| Spring Data JPA(Hibernate) | - | ORM |
| QueryDSL | 5.1.0+ (Jakarta EE 호환) | 동적 필터/정렬/검색 조립 |
| Spring Security | - | 인증/인가 |
| OAuth2 Client | - | 소셜 로그인 |
| 세션/JWT | - | MVP: 세션+CSRF (SSR 최적), 확장: JWT (API 분리 시) |
| Validation | - | 입력 검증 |
| Flyway | - | DDL 마이그레이션 |
| Redis | - | 캐시/레이트리밋/어뷰징 방지 |
| (선택) Outbox/메시징 | - | 알림/인덱싱/후처리 비동기화 |

### 2.2 Database / Search / Storage
| 기술 | 용도 |
|---|---|
| PostgreSQL 16+ | 메인 RDB(피드/거래/정책 로그) |
| Postgres FTS(+trigram) | MVP 검색 |
| (확장) Meilisearch/OpenSearch | 고급 검색/추천 |
| S3 호환 스토리지(AWS S3/Cloudflare R2) | 이미지/첨부(영수증/전단) |
| Presigned Upload | 대용량 업로드 성능/비용 최적화 |

### 2.3 Frontend(Server-Side Rendering + Partial Update)
| 기술 | 용도 |
|---|---|
| Thymeleaf | SSR 템플릿 |
| Thymeleaf Layout Dialect(선택) | 레이아웃 구성 |
| HTMX | 부분 갱신(HTML swap) |
| Tailwind CSS | 스타일링(초기 CDN → 필요 시 빌드 전환) |
| Alpine.js(선택) | 모달/드롭다운 등 최소 상태 |
| 지도 SDK(카카오/네이버) | 특정 화면에서만 최소 JS 연동 |

### 2.4 배포/운영
| 기술 | 용도 |
|---|---|
| Docker | 재현 가능한 빌드/배포 |
| GitHub Actions | CI/CD(빌드/테스트/배포) |
| Managed Postgres/Redis | 운영 부담 최소화 |
| Observability(선택) | JSON 로그, traceId, Micrometer, Sentry |

---

## 3. 프로젝트 구조

### 3.1 디렉토리 구조(권장: 모듈러 모놀리스)
```
src/main/java/com/townpet/
├── TownPetApplication.java
├── common/                 # 공통(에러코드, 응답 포맷, 유틸, base entity)
├── config/                 # 보안, 웹, JPA, Flyway, Redis, CORS/CSRF, 메시징(선택)
├── auth/                   # OAuth2/JWT, 로그인/가입/토큰, 세션정책
├── users/                  # 사용자/프로필/반려동물 프로필, 신뢰점수
├── neighborhood/           # 동네/지역설정, 장소(병원/식당), 리뷰 템플릿
├── walk/                   # 산책로/태그, 코스 공유
├── meetups/                # 번개/메이트, 참여/노쇼
├── posts/                  # 커뮤니티 글(로컬/글로벌), 카테고리
├── comments/               # 댓글/대댓글, 좋아요
├── qna/                    # Q&A(채택/가중치)
├── catalog/                # 사료/용품 DB, 성분/알러지 필터(Phase 확장)
├── market/                 # 중고/대여/나눔, 거래 상태/분쟁
├── jobs/                   # 펫케어 구인/구직, 지원/상태
├── care/                   # 마이크로 펫시팅/긴급 돌봄(요청/수락/완료)
├── missing/                # 실종/유기 제보, 위치 노출, 전단지
├── notifications/          # 알림(인앱/이메일/푸시 선택)
├── moderation/             # 신고/차단/자동 블라인드, 어뷰징 방지
└── audit/                  # 관리자 조치 로그(면접 포인트)
```

### 3.2 리소스/템플릿 구조(SSR + HTMX 표준)
```
src/main/resources/
├── static/
│   ├── css/                # (선택) Tailwind build 산출물
│   ├── js/                 # 지도/최소 유틸(필요 시)
│   └── images/
└── templates/
    ├── layout/             # base layout, head, nav
    ├── pages/              # /p/** Full Page
    ├── fragments/          # /f/** HTMX swap fragment
    └── errors/             # 에러 페이지/프래그먼트
```

### 3.3 라우팅 컨벤션
- **Page(SSR)**: `/p/**` (레이아웃 포함 전체 페이지)
- **Fragment(HTMX)**: `/f/**` (부분 갱신용 HTML 조각)
- **JSON API**: `/api/v1/**` (지도/업로드/특수 기능 중심)

---

## 4. 도메인 모델

### 4.1 핵심 엔티티(요약)
```
USER(사용자)
├── PET_PROFILE(반려동물 프로필) 1:N
├── NEIGHBORHOOD(동네 설정) N:1
├── TRUST_SCORE(신뢰/활동 점수)
└── BLOCK(차단)/REPORT(신고)

PLACE(장소)
├── PLACE_TYPE(병원/미용/동반식당/카페 등)
└── PLACE_REVIEW(템플릿 기반 리뷰) 1:N
    └── REVIEW_ITEM(방문일/진료항목/비용/대기시간 등)

WALK_ROUTE(산책로)
└── ROUTE_TAG(가로등/화장실/난이도/안전 등)

MEETUP(번개/메이트)
├── MEETUP_PARTICIPANT
└── NO_SHOW_POLICY(노쇼 누적/제한)

MARKET_LISTING(거래/나눔/대여)
├── LISTING_TYPE(중고/나눔/대여)
├── RENTAL_TERM(대여기간/보증금/체크리스트)
└── TRADE_CASE(문의/예약/완료/분쟁)

JOB_POST(구인)
└── JOB_APPLICATION(지원/상태)

CARE_REQUEST(돌봄 요청)
└── CARE_ASSIGNMENT(수락/완료/평가)

MISSING_REPORT(실종/유기)
└── GEO_ALERT(반경 기반 노출/알림)

MODERATION
├── REPORT(신고)
├── ACTION(숨김/제재)
└── AUDIT_LOG(관리자 조치)
```

### 4.2 상태 모델(예: 공통 Status)
- 게시물/댓글: `ACTIVE → HIDDEN(자동/관리) → DELETED(soft)`
- 거래: `OPEN → RESERVED → COMPLETED` (+ `DISPUTED`)
- 구인: `OPEN → REVIEWING → CLOSED`
- 돌봄: `REQUESTED → ACCEPTED → DONE` (+ `CANCELED/NO_SHOW`)

---

## 5. 주요 기능 분석

### 5.1 Local(동네 기반)

#### 5.1.1 병원/장소 템플릿 리뷰
- 장소 프로필: 기본 정보 + 태그(동반 가능/테라스/주차 등)
- 리뷰 템플릿: 방문일, 진료 항목, 비용, 대기시간, 서비스 만족 등 구조화 입력
- 비교/정렬: “비용/대기/만족도” 필터 및 최신성 가중치

#### 5.1.2 산책로 공유(지도)
- 코스(라인/포인트) + 태그(가로등/화장실/오르막/혼잡 등)
- 안전/환경 중심 메타데이터를 검색 가능한 형태로 저장

#### 5.1.3 산책 메이트 & 번개
- “지금 공원 오실 분” 형태의 실시간 게시(짧은 TTL)
- 노쇼 정책: 누적 기반 제한(커뮤니티 안전 장치)

#### 5.1.4 마켓 & 대여 & 나눔
- 게시글 타입: 중고/나눔/대여
- 대여: 보증금/기간/인수·반납 체크리스트
- 분쟁: 신고 → 보류/숨김 → 관리자 큐

#### 5.1.5 마이크로 펫시팅(심부름/긴급 돌봄)
- 요청 템플릿(시간/장소/요구사항/주의사항)
- 매칭/수락/완료 상태 관리(결제는 Phase 4 이후로 분리 가능)

#### 5.1.6 실종/유기 신고(골든타임)
- 신고 등록 시 반경 기반 노출(피드/알림)
- 전단지 이미지 생성/업로드, 발견 제보 스레드

### 5.2 Global(지역 무관)

#### 5.2.1 품종/묘종 토픽 커뮤니티
- 토픽별 게시판 + 태그(훈련/건강/행동/사료)

#### 5.2.2 Q&A(채택/신뢰도)
- 답변 채택(해결 여부), 답변자 신뢰도 가중치
- 검색 유입 최적화(SSR 메타/OG)

#### 5.2.3 사료/용품 DB
- 성분/알러지 필터, “유사 제품” 추천(초기엔 룰 기반)
- 리뷰 축적을 통한 신뢰도 형성

#### 5.2.4 전문가 콘텐츠(선택)
- 자격/면책/검수 정책 기반 “전문가 게시” 구분

### 5.3 비즈니스 모델(BM) 연결 포인트
- 지역 광고/부스팅: 병원/미용/카페 상단 노출, 쿠폰
- 중개 수수료: 펫시팅/도그워커 매칭(Phase 4 결제/정산)
- 공동구매: 사료/모래 등 부피 큰 상품의 배송비 절감
- 어필리에이트: 사료/용품 추천 링크
- 프리미엄: 광고 제거, 상담권, 멤버십 전용 혜택(후순위)

---

## 6. 보안/운영(신뢰) 구현

### 6.1 인증/인가
- OAuth2 로그인(선택) + JWT 기반 인증
- RBAC(Role) + 리소스 소유권(작성자/참여자) 검증
- 관리자 기능은 Audit Log 필수 기록

### 6.2 SSR/HTMX 특성에 맞춘 보안
- CSRF: SSR 폼 + HTMX 요청에 CSRF 토큰 포함(권장)
- XSS: 템플릿 출력 이스케이프 기본, 사용자 입력은 서버 측 정규화/검증
- 파일 업로드: presigned URL + MIME/크기 제한 + 악성 확장자 차단

### 6.3 운영 자동화(커뮤니티 생존 조건)
- 레이트리밋: 글/댓글/검색/로그인/신고 등 핵심 엔드포인트
- 신규 계정 제한: 가입 직후 마켓/돌봄/긴급 신고 기능 제한(신뢰 점수 기반 해제)
- 자동 블라인드: 신고 누적/패턴 탐지(링크/연락처 스팸) → HIDDEN
- 관리자 큐: 신고/이의제기/분쟁 케이스 워크플로우

---

## 7. 현재 설계 리스크 및 보완 과제

1. **정책/운영 로직의 복잡도**
   - 커뮤니티는 “기능”보다 “운영”이 난이도 핵심. 정책 엔진/감사로그/자동화 우선순위를 유지해야 한다.

2. **지도/위치 기능의 프라이버시**
   - 산책/실종/번개는 위치 데이터 민감도가 높다.
   - 저장 범위(정밀도), 노출 반경, 보관 기간(TTL), 익명화 정책이 필요하다.

3. **마켓/대여/돌봄의 분쟁**
   - 결제 전 단계에서도 분쟁이 발생한다.
   - 상태/증거(채팅/이미지)/중재(관리자) 모델을 최소 단위로라도 설계해야 한다.

4. **검색/피드 성능**
   - 템플릿 리뷰/태그/필터가 늘면 Query가 급격히 복잡해진다.
   - 초기부터 인덱스/커서 페이지네이션/FTS 전략을 포함해야 한다.

5. **PWA/푸시 알림**
   - “실종/유기 골든타임”에 유용하지만, 권한/정책/스팸/차단 UX까지 함께 설계되어야 한다.
   - Phase 2~3 이후 도입을 기본값으로 한다.

---

## 부록: 문서/설계 키워드(이력서 관점)
- 모듈러 모놀리스, 운영 자동화(Moderation), 레이트리밋, 감사로그(Audit Log)
- SSR+HTMX 기반 하이퍼미디어, 커서 기반 페이지네이션, Postgres FTS
- Docker + GitHub Actions CI/CD, Testcontainers 기반 통합 테스트(선택)
